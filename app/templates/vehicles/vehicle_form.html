{% extends "base.html" %}
{% block title %}{% if view.object %}Editar veículo{% else %}Novo veículo{% endif %}{% endblock %}
{% block header %}{% if view.object %}Editar veículo{% else %}Novo veículo{% endif %}{% endblock %}

{% block content %}

<form method="post" class="row g-3">
  {% csrf_token %}
  {{ form.non_field_errors }}

  <!-- Identificação -->
  <div class="col-12">
    <div class="card">
      <div class="card-header"><strong>Identificação</strong></div>
      <div class="card-body row g-3">
        <div class="col-md-6">
          <label class="form-label">Nome do veículo</label>
          {{ form.name }}
          <div class="form-text">Ex.: “Notícia Max”, “Jornal XPTO”.</div>
          <div class="text-danger small">{{ form.name.errors }}</div>
        </div>

        <div class="col-md-6">
          <label class="form-label">URL</label>
          <div class="input-group">
            {{ form.url }}
            <span class="input-group-text">↗</span>
          </div>
          <div class="form-text">Cole a página inicial do veículo. Se não incluir <code>http(s)://</code>, será adicionado automaticamente.</div>
          <div class="text-danger small">{{ form.url.errors }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Classificação -->
  <div class="col-12">
    <div class="card">
      <div class="card-header"><strong>Classificação</strong></div>
      <div class="card-body row g-3">
        <div class="col-md-6">
          <label class="form-label">Tipo</label>
          {{ form.media_type }}
          <div class="form-text">Site, blog, revista, TV, rádio, podcast ou videocast.</div>
          <div class="text-danger small">{{ form.media_type.errors }}</div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Status</label>
          {{ form.status }}
          <div class="form-text">Marque “Ativo” para participar das importações.</div>
          <div class="text-danger small">{{ form.status.errors }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Localização -->
  <div class="col-12">
    <div class="card">
      <div class="card-header"><strong>Localização</strong></div>
      <div class="card-body row g-3">
        <div class="col-md-4">
          <label class="form-label">País</label>
          {{ form.country }}
          <div class="text-danger small">{{ form.country.errors }}</div>
        </div>
        <div class="col-md-4">
          <label class="form-label">Estado</label>
          {{ form.state }}
          <div class="text-danger small">{{ form.state.errors }}</div>
        </div>
        <div class="col-md-4">
          <label class="form-label">Cidade</label>
          {{ form.city }}
          <div class="text-danger small">{{ form.city.errors }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Observações -->
  <div class="col-12">
    <div class="card">
      <div class="card-header"><strong>Observações</strong></div>
      <div class="card-body">
        {{ form.notes }}
        <div class="form-text">Informações internas sobre o veículo (opcional).</div>
        <div class="text-danger small">{{ form.notes.errors }}</div>
      </div>
    </div>
  </div>

  <!-- Ações (grudenta) -->
  <div class="col-12">
    <div class="bg-body border rounded p-2 d-flex gap-2 justify-content-end position-sticky" style="bottom: 0;">
      <a class="btn btn-outline-secondary" href="{% url 'vehicles:vehicle-list' %}">Cancelar</a>
      <button class="btn btn-primary" type="submit">Salvar</button>
    </div>
  </div>
</form>

<!-- Estilo leve para notas -->
<style>
  textarea[name$="notes"] {
    min-height: 110px;
  }
</style>

<!-- Script: completa https:// na URL se faltar -->
<script>
  (function () {
    const el = document.querySelector('input[name="url"]');
    if (!el) return;
    el.addEventListener('blur', function () {
      let v = (this.value || '').trim();
      if (!v) return;
      if (!/^https?:\/\//i.test(v)) {
        this.value = 'https://' + v;
      }
    });
  })();
</script>

{% endblock %}
